# 告警管理前端界面使用指南

## ✅ 已完成的功能

### 1. 侧边栏菜单
- ✅ 新增「告警管理」菜单项
- 位置：在「资料转换」和「日志查询」之间

### 2. 仪表板增强
- ✅ 新增「活跃告警」统计卡片
- 显示当前活跃的告警数量
- 每分钟自动刷新
- 使用警告色高亮显示

### 3. 告警规则管理页面

#### 功能列表
- ✅ **查看告警规则列表**
  - 显示规则名称、类型、监控目标、阈值等信息
  - 支持分页浏览
  - 颜色标记区分不同告警类型

- ✅ **新增告警规则**
  - 点击「+ 新增告警规则」按钮
  - 填写规则配置：
    - 规则名称
    - 告警类型（错误率、响应时间、流量异常）
    - 监控目标（全局、特定端点、特定系统）
    - 阈值和单位
    - 时间窗口
    - 通知渠道（Webhook、Email）
    - 启用/停用状态

- ✅ **编辑告警规则**
  - 点击规则行的「编辑」按钮
  - 修改规则参数
  - 保存更新

- ✅ **删除告警规则**
  - 点击规则行的「删除」按钮
  - 确认后删除

#### 表格列说明
| 列名 | 说明 |
|------|------|
| 規則名稱 | 告警规则的名称 |
| 類型 | 告警类型（错误率/响应时间/流量异常）|
| 監控目標 | 全局/端点/系统 |
| 閾值 | 触发告警的阈值及单位 |
| 時間窗口 | 统计时间窗口（秒）|
| 通知方式 | Webhook、Email 徽章 |
| 狀態 | 启用/停用 |
| 操作 | 编辑、删除按钮 |

### 4. 告警历史查看页面

#### 功能列表
- ✅ **查看告警历史**
  - 显示所有触发的告警记录
  - 按时间倒序排列
  - 支持分页浏览

- ✅ **筛选告警历史**
  - 按状态筛选：全部/活跃/已确认/已解决
  - 下拉选择后自动刷新列表

- ✅ **确认告警**
  - 对活跃告警点击「确认」按钮
  - 状态变更为「已确认」
  - 表示已知晓此告警

- ✅ **解决告警**
  - 对活跃告警点击「解决」按钮
  - 状态变更为「已解决」
  - 表示问题已处理

- ✅ **手动刷新**
  - 点击「重新整理」按钮
  - 重新加载最新数据

#### 表格列说明
| 列名 | 说明 |
|------|------|
| 時間 | 告警触发时间 |
| 規則名稱 | 关联的告警规则 |
| 告警級別 | INFO/WARNING/CRITICAL |
| 告警消息 | 详细的告警描述 |
| 指標值 | 触发时的实际指标值 |
| 狀態 | 活跃/已确认/已解决 |
| 操作 | 确认、解决按钮 |

### 5. 视觉设计

#### 颜色体系
- **告警级别徽章**
  - INFO: 蓝色 (#dbeafe)
  - WARNING: 黄色 (#fef3c7)
  - CRITICAL: 红色 (#fee2e2)

- **告警状态徽章**
  - 活跃: 红色 (#fee2e2)
  - 已确认: 黄色 (#fef3c7)
  - 已解决: 绿色 (#d1fae5)

- **告警类型徽章**
  - 紫蓝色 (#e0e7ff)

- **通知渠道徽章**
  - 灰色 (#f3f4f6)

---

## 📋 使用流程示例

### 场景 1：创建新的告警规则

1. 点击侧边栏「告警管理」
2. 点击「+ 新增告警规则」按钮
3. 填写表单：
   ```
   规则名称：API 端点高错误率告警
   告警类型：错误率
   描述：当 API 错误率超过 10% 时触发
   监控目标：全局
   阈值：10
   单位：%
   时间窗口：300 （5分钟）
   通知渠道：✓ Webhook
   Webhook URL：https://your-webhook.site/alerts
   状态：启用
   ```
4. 点击「储存」
5. 规则立即生效，开始监控

### 场景 2：处理活跃告警

1. 进入「告警管理」页面
2. 查看「告警历史」部分
3. 看到活跃告警（红色徽章）
4. 阅读告警消息，了解问题
5. 点击「确认」按钮表示已知晓
6. 处理问题后，点击「解决」按钮
7. 告警状态变为「已解决」（绿色徽章）

### 场景 3：查看仪表板告警统计

1. 打开管理后台首页
2. 查看右上角第四个统计卡片「活跃告警」
3. 显示当前未处理的告警数量
4. 数量会自动每分钟更新
5. 如有告警，点击侧边栏「告警管理」查看详情

---

## 🎨 界面截图说明

### 告警规则配置 Modal
```
┌─────────────────────────────────────┐
│  新增告警規則                    ✕  │
├─────────────────────────────────────┤
│  規則名稱: [________________]       │
│  告警類型: [錯誤率 ▼]              │
│  描述:     [________________]       │
│  監控目標: [全局 ▼]                │
│  閾值:     [___] [%]                │
│  時間窗口: [300]                    │
│  通知渠道: ☑ Webhook  ☐ Email     │
│  Webhook URL: [________________]    │
│  狀態:     [啟用 ▼]                 │
├─────────────────────────────────────┤
│             [取消]  [儲存]          │
└─────────────────────────────────────┘
```

### 告警历史表格
```
┌──────────────────────────────────────────────────────────┐
│ 時間            規則名稱      級別     狀態      操作    │
├──────────────────────────────────────────────────────────┤
│ 2024-11-22     全局錯誤率   WARNING   活跃   [確認][解決]│
│ 10:30:15       告警                                       │
│                錯誤率 12.5%                                │
│                超過閾值 5%                                 │
└──────────────────────────────────────────────────────────┘
```

---

## 🔧 技术实现

### 文件清单
- `public/index.html` - 告警管理页面 HTML
- `public/style.css` - 告警样式（新增 70+ 行）
- `public/alerts.js` - 告警管理 JavaScript（360 行）

### API 调用
```javascript
// 获取告警规则
GET /api/admin/alerts/rules?page=1&limit=10

// 创建告警规则
POST /api/admin/alerts/rules

// 编辑告警规则
PUT /api/admin/alerts/rules/{id}

// 删除告警规则
DELETE /api/admin/alerts/rules/{id}

// 获取告警历史
GET /api/admin/alerts/history?status=active&page=1

// 确认/解决告警
PATCH /api/admin/alerts/history/{id}
```

### 自动刷新机制
- 仪表板告警计数：每 60 秒自动刷新
- 告警历史：手动刷新（点击按钮）
- 告警规则：页面切换时加载

---

## ✨ 特色功能

1. **实时告警计数**
   - 仪表板显示活跃告警数量
   - 自动刷新，无需手动操作

2. **智能表单**
   - 监控目标选择「全局」时，自动隐藏「目标 ID」字段
   - 通知渠道勾选联动相应的配置字段

3. **颜色编码**
   - 不同告警级别使用不同颜色
   - 快速识别告警严重程度

4. **完整的 CRUD**
   - 创建、读取、更新、删除告警规则
   - 确认、解决告警历史

5. **筛选和分页**
   - 按状态筛选告警历史
   - 支持大量数据的分页浏览

---

## 🚀 快速开始

1. **启动服务器**
   ```bash
   node server.js
   ```

2. **访问管理后台**
   ```
   http://localhost:3000
   ```

3. **查看告警管理**
   - 点击侧边栏「告警管理」
   - 即可看到预设的 3 条默认规则

4. **测试告警**
   - 发送一些错误请求触发告警
   - 等待 1 分钟让监控服务检查
   - 查看告警历史中是否有新记录

---

## 📝 注意事项

1. **API Key 认证**
   - 前端需要配置正确的 API Key
   - 默认使用环境变量或配置文件中的 Key

2. **Webhook 测试**
   - 可以使用 https://webhook.site 获取测试 URL
   - 实际部署时替换为真实的告警接收端点

3. **浏览器兼容性**
   - 支持现代浏览器（Chrome, Firefox, Edge, Safari）
   - 使用了 ES6+ 语法和 Fetch API

4. **性能优化**
   - 使用分页避免一次加载过多数据
   - 告警计数使用轻量级查询

---

## 🎉 总结

**告警管理前端界面已完整实现！**

包含：
- ✅ 完整的告警规则 CRUD 界面
- ✅ 告警历史查看和处理
- ✅ 仪表板告警统计
- ✅ 精美的 UI 设计
- ✅ 流畅的交互体验

立即打开浏览器访问 http://localhost:3000 体验吧！
